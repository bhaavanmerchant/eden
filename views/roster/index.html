{{extend 'layout.html'}}
<head><script type="text/javascript">
    var current_cell={"r":0,
                      "c":0};
jQuery(document).ready(function(){
    $('#newrole').hide();
    $('#r_varea').hide();
    $('.remv').hide();
    $('#addrow').click(function(){$('#newrole').toggle(); $('#addrow').hide();});
    $('#new_job_role').change(function(){$('#roster_info_form').submit();});
    $('#project_selector').change(function(){$('#roster_info_form').submit();});
    $('#timeframe').change(function(){$('#roster_info_form').submit();});
    $('#timeslot').change(function(){$('#roster_info_form').submit();});
    $('.addv').click(function()
        {
        $('#r_varea').show();
        var cell=$(this).parent();
        current_cell.r=cell.data('row');
        current_cell.c=cell.data('col');
        //ajax('people',['row'],'vn');
        $.ajax(
            {
            type: "POST",
            url: "people",
            data: { row: current_cell.r }
            }).done(function( msg ) 
                {
                $("#vn").html(msg);
                });

        });
    $('#vn').on('click','.volunteer_names',function(event)
        {
        var vname=$(this).html();
        var vid=$(this).attr('id');
        $('.vcell').each(function()
            {
            if($(this).data('row')==current_cell.r && $(this).data('col')==current_cell.c)
                {
                var cell_c=vname;
                $(this).children('.vcelln').html(cell_c);
                $(this).children('.addv').hide();
                $(this).children('.remv').show();
                $(this).data("vid",vid);
                $(this).addClass('allotted');
                
                }; 
            });
        });
    $('.remv').click(function(){
    $(this).parent().children('.vcelln').html("");
    $(this).parent().children('.remv').hide();
    $(this).parent().children('.addv').show();
    $(this).parent().removeClass('allotted');
    });
    $('#cross').click(function(){$('#r_varea').hide();});
    $('#save').click(function()
    {
    var roster_dets={};
    var i=0;
    $('.allotted').each(function()
        {
        var v_json= {
                    "row":$(this).data('row'),
                    "col":$(this).data('col'),
                    "vid":$(this).data('vid')
                    };
        roster_dets[i]=v_json;
        i=i+1;     
        });
    //alert(roster_dets);
    });
    
});
</script>
<link href="/{{=request.application}}/static/styles/S3/roster.css" rel="stylesheet" type="text/css" media="screen" charset="utf-8" />
</head>
<body>
<div id="maincontent">
<h1>{{=message}}</h1>
<span>
<div id="r_varea">
<div id="r_varea_head">Volunteers:</div>
{{=IMG(_src='/eden/static/img/cross.png',_alt='cross',_id='cross')}}
<br/>
<div class='vn' id='vn'>
{{for v_id in volunteers:}}
<div class="volunteer_names" id={{=v_id}}>{{=volunteers[v_id]}}</div>
{{pass}}
</div>
</div>
</span>
<span style="position:absolute; right:50px;">
<div id="r_tablearea">
<form enctype="multipart/form-data" id="roster_info_form" action="{{=URL()}}" method="post">
<div id="selectboxes">
<span>Project:
<select name='project_selector' id='project_selector'>
{{for x in range(len(projects)):}}<option value={{=x}}>{{=projects[x]}}</option>{{pass}}
</select> </span> <span style="position:relative; left:150px;">
<select name='timeframe' id='timeframe'>
{{for i in range(numb):}}
  <option value={{=i+1}}>Week {{=i+1}} {{=project_date}} {{project_date=project_date+datetime.timedelta(days=6)}} {{=project_date}}{{project_date=project_date+datetime.timedelta(days=1)}}</option>
{{pass}}
</select> </span> <span style="position:relative; left:350px;">
Slot:
<select name='timeslot' id='timeslot'>
{{for x in range(len(slots)):}}<option value={{=x}}>{{=slots[x]}}</option>{{pass}}
</select> </span>
</div>
<br/>
<table id="r_table">
<thead>
<tr><th>Role</th>{{for d in time_dets:}}<th>{{=d}}</th>{{pass}}
</tr></thead>
{{for r in range(len(alloted_roles)):}}
<tr><td><div class='vcell'>{{=alloted_roles[r]}}{{=IMG(_src='/eden/static/img/minus.png', _class='symbv')}}</div> </td>
{{for c in range(len(time_dets)):}}<td><div class='vcell' data-col={{=c}} data-row={{=r}} > <div class='vcelln'></div> {{=IMG(_src='/eden/static/img/plus.png',_alt='addv',_class='addv symbv')}}{{=IMG(_src='/eden/static/img/minus.png',_alt='remv',_class='remv symbv')}} </div> </td>{{pass}}
</tr>
{{pass}}

<tr id='newrole'><td>
<select name="new_job_role" id="new_job_role">
{{for x in range(len(job_roles)):}}<option value={{=x}}>{{=job_roles[x]}}</option>{{pass}}
</select></form></td>
{{for x in range(len(time_dets)):}}<td></td>{{pass}}
</tr>

</table>
{{=IMG(_src='/eden/static/img/plus.png',_alt='addrow',_id='addrow')}}
<br/>
<span> <input type="button" value="Save" id='save'/> </span> <span> <a>Cancel</a> </span> <span> <a>Reset</a> </span> <span> <a>Autofill</a> </span> 
</div>
</span>
</div>
</body>
